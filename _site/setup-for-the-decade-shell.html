<!doctype html>
<html lang="en">
  <head>
    <title>Setup for the Decade: Shell || Chrysanthium</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="akullpp" />
    <meta name="description" content="About software engineering" />
    <meta name="email" content="akullpp@gmail.com" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:creator" content="" />
    <meta name="twitter:title" content="Setup for the Decade: Shell" />
    <meta name="twitter:image" content="https://chrysanthium.com/logo.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/tomorrow.css">
  </head>

  <body>
    <header class="navigation">
      <ul>
        <li>
          <a href="/">Blog</a>
        </li>

        <li>
          <a href="/about">About</a>
        </li>
      </ul>
    </header>

    <h1>Setup for the Decade: Shell</h1>
    
      <h6>2020/02</h6>
    

    <p><a href="/setup-for-the-decade-basics">First Part: Setup for the Decade: Basics</a></p>
<p>A good shell environment is the key to productivity and goes far beyond of just installing iTerm2 and selecting a nice color scheme. No other shell does it better than <a href="https://en.wikipedia.org/wiki/Z_shell">Z shell</a> better known as zsh which is fortunately the default now for macOS Catalina. It does a lot of things out of the box like folder and tab completion, typo correction, changing directories without typing <code>cd</code>, advanced globbing, multi-session shared history.</p>
<p>While this sounds nice, the best argument for using zsh is it's ecosystem with a myriad of plugins from which I prefer <a href="https://github.com/sorin-ionescu/prezto">Prezto</a> because it is the fastest configuration framework for zsh while still being user-friendly.</p>
<p>As always the entire code can be found on <a href="https://github.com/akullpp/settings">GitHub</a>.</p>
<h2>Prezto</h2>
<p>The installation is easy enough, just ensure you are in zsh:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">zsh</span>

<span class="token function">git</span> clone <span class="token parameter variable">--recursive</span> https://github.com/sorin-ionescu/prezto.git <span class="token string">"<span class="token variable">${ZDOTDIR<span class="token operator">:-</span>$HOME}</span>/.zprezto"</span>

setopt EXTENDED_GLOB
<span class="token keyword">for</span> <span class="token for-or-select variable">rcfile</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${ZDOTDIR<span class="token operator">:-</span>$HOME}</span>"</span>/.zprezto/runcoms/^README.md<span class="token punctuation">(</span>.N<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token function">ln</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$rcfile</span>"</span> <span class="token string">"<span class="token variable">${ZDOTDIR<span class="token operator">:-</span>$HOME}</span>/.<span class="token variable">${rcfile<span class="token operator">:</span>t}</span>"</span>
<span class="token keyword">done</span>

chsh <span class="token parameter variable">-s</span> /bin/zsh</code></pre>
<p>You will then have a new configuration file <code>.zpreztorc</code> where you want to configure the theme and available <a href="https://github.com/sorin-ionescu/prezto/tree/master/modules">modules</a>. First of all you can look at the default themes with <code>prompt -l</code> and preview them with <code>promp -p &lt;name&gt;</code>. I go for <code>sorin</code> because it provides exactly the right amount of information for me:</p>
<p><img src="images/sorin.png" alt="sorin"></p>
<pre class="language-shell"><code class="language-shell">zstyle <span class="token string">':prezto:module:prompt'</span> theme <span class="token string">'sorin'</span></code></pre>
<p>The only thing I customize is the titles of the window which should show the full path and the tabs which should show the last path segment:</p>
<pre class="language-shell"><code class="language-shell">zstyle <span class="token string">':prezto:module:terminal'</span> auto-title <span class="token string">'yes'</span>
zstyle <span class="token string">':prezto:module:terminal:window-title'</span> <span class="token function">format</span> <span class="token string">'%s'</span>
zstyle <span class="token string">':prezto:module:terminal:tab-title'</span> <span class="token function">format</span> <span class="token string">'%c'</span></code></pre>
<p><img src="images/shell.png" alt="shell"></p>
<p>For plugins I only use a few because most of them are about hotkeys as you can read in <a href="https://github.com/sorin-ionescu/prezto/tree/master/modules">the respective directory</a>:</p>
<pre class="language-shell"><code class="language-shell">zstyle <span class="token string">':prezto:load'</span> pmodule <span class="token punctuation">\</span>
  <span class="token string">'git'</span> <span class="token punctuation">\</span>
  <span class="token string">'terminal'</span> <span class="token punctuation">\</span>
  <span class="token string">'history'</span> <span class="token punctuation">\</span>
  <span class="token string">'spectrum'</span> <span class="token punctuation">\</span>
  <span class="token string">'completion'</span> <span class="token punctuation">\</span>
  <span class="token string">'syntax-highlighting'</span> <span class="token punctuation">\</span>
  <span class="token string">'history-substring-search'</span> <span class="token punctuation">\</span>
  <span class="token string">'prompt'</span></code></pre>
<p>The module <code>git</code> enables a few hotkeys (which I do not use) but most importantly it enables us to show the status of a git repository in the prompt as you saw before.</p>
<p><code>terminal</code> is required to change the titles of the window and tabs. <code>history</code> is self-explanatory.</p>
<p><code>spectrum</code> enables better colors and effects.</p>
<p><code>syntax-highlighting</code> is self-explanatory again.</p>
<p><code>history-substring-search</code> is the reason I fell in love with zsh (although it is originally from fish) which enables you to type any part of any command you have ever written and navigate the history with the arrow keys:</p>
<p><img src="/images/search.gif" alt="search"></p>
<p>Finally <code>prompt</code> is required for customization of the prompt of course.</p>
<p>All of this results in the following <code>.zpreztorc</code>:</p>
<pre class="language-shell"><code class="language-shell">zstyle <span class="token string">':prezto:*:*'</span> color <span class="token string">'yes'</span>

zstyle <span class="token string">':prezto:load'</span> pmodule <span class="token punctuation">\</span>
  <span class="token string">'git'</span> <span class="token punctuation">\</span>
  <span class="token string">'terminal'</span> <span class="token punctuation">\</span>
  <span class="token string">'history'</span> <span class="token punctuation">\</span>
  <span class="token string">'spectrum'</span> <span class="token punctuation">\</span>
  <span class="token string">'completion'</span> <span class="token punctuation">\</span>
  <span class="token string">'syntax-highlighting'</span> <span class="token punctuation">\</span>
  <span class="token string">'history-substring-search'</span> <span class="token punctuation">\</span>
  <span class="token string">'prompt'</span>

zstyle <span class="token string">':prezto:module:prompt'</span> theme <span class="token string">'sorin'</span>
zstyle <span class="token string">':prezto:module:terminal'</span> auto-title <span class="token string">'yes'</span>
zstyle <span class="token string">':prezto:module:terminal:window-title'</span> <span class="token function">format</span> <span class="token string">'%s'</span>
zstyle <span class="token string">':prezto:module:terminal:tab-title'</span> <span class="token function">format</span> <span class="token string">'%c'</span></code></pre>
<h2>Tools provided by npm</h2>
<p>First we start with the tools installed by <code>npm i -g &lt;name&gt;</code>.</p>
<h3><a href="https://github.com/so-fancy/diff-so-fancy">diff-so-fancy</a></h3>
<p><code>diff-so-fancy</code> strives to make your diffs human readable instead of machine readable. This helps improve code quality and helps you spot defects faster.</p>
<p><img src="images/diff.png" alt="diff"></p>
<h3><a href="https://github.com/lirantal/dockly">dockly</a></h3>
<p><code>dockly</code> describes itself as an immersive terminal interface for managing docker containers and services. This is not even half the truth, you can get every available information about the container, immediately jump inside with an interactive shell running and have logging support.</p>
<p><img src="images/dockly.png" alt="dockly"></p>
<h3><a href="https://github.com/tjunnone/npm-check-updates">npm-check-updates</a></h3>
<p>Did you know that most Node.js modules do not get updated once installed? Especially in Enterprise-context we often pin the versions. I do run <code>ncu</code> frequently to assess what I want or need to update, that is the reason why I install it globally:</p>
<pre class="language-shell"><code class="language-shell">~/P/p/chrysanthium ❯❯❯ ncu                                                                                                                                                                                                         master ✱ ◼
Checking /Users/kulland/Projects/private/chrysanthium/package.json
<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token number">26</span>/26 <span class="token number">100</span>%

 @emotion/core                   ^10.0.15  →  ^10.0.27
 @emotion/styled                 ^10.0.15  →  ^10.0.27
 gatsby                          ^2.13.50  →  ^2.19.12
 gatsby-plugin-catch-links         ^2.1.2  →   ^2.1.25
 gatsby-plugin-emotion             ^4.1.2  →   ^4.1.22
 gatsby-plugin-react-helmet        ^3.1.3  →   ^3.1.22
 gatsby-plugin-sharp               ^2.2.9  →    ^2.4.5
 gatsby-plugin-sitemap             ^2.2.5  →   ^2.2.27
 gatsby-remark-autolink-headers    ^2.1.3  →   ^2.1.24
 gatsby-remark-images              ^3.1.7  →   ^3.1.44
 gatsby-remark-prismjs             ^3.3.4  →   ^3.3.31
 gatsby-source-filesystem          ^2.1.8  →   ^2.1.48
 gatsby-transformer-remark        ^2.6.10  →   ^2.6.50
 prismjs                          ^1.17.1  →   ^1.19.0
 react-dom                        ^16.8.6  →  ^16.12.0
 eslint                            ^6.1.0  →    ^6.8.0
 eslint-config-airbnb             ^17.1.1  →   ^18.0.1
 eslint-config-prettier            ^6.0.0  →   ^6.10.0
 eslint-plugin-import             ^2.18.2  →   ^2.20.1
 eslint-plugin-react              ^7.14.3  →   ^7.18.3
 prettier                         ^1.18.2  →   ^1.19.1

Run ncu <span class="token parameter variable">-u</span> to upgrade package.json</code></pre>
<h3><a href="https://github.com/tldr-pages/tldr">tldr</a></h3>
<p>man pages are pretty awful to read and from another century, e.g. want to know what is running on port 3000? Check the man page for <a href="https://linux.die.net/man/8/lsof">lsof</a> and maybe in a month or two you have an answer. Now compare this to <code>tldr lsof</code>:</p>
<pre class="language-shell"><code class="language-shell"> <span class="token function">lsof</span>

  Lists <span class="token function">open</span> files and the corresponding processes.
  Note: Root privileges <span class="token punctuation">(</span>or <span class="token function">sudo</span><span class="token punctuation">)</span> is required to list files opened by others.

  - Find the processes that have a given <span class="token function">file</span> open:
    <span class="token function">lsof</span> path/to/file

  - Find the process that opened a <span class="token builtin class-name">local</span> internet port:
    <span class="token function">lsof</span> <span class="token parameter variable">-i</span> :port

  - Only output the process ID <span class="token punctuation">(</span>PID<span class="token punctuation">)</span>:
    <span class="token function">lsof</span> <span class="token parameter variable">-t</span> path/to/file

  - List files opened by the given user:
    <span class="token function">lsof</span> <span class="token parameter variable">-u</span> username

  - List files opened by the given <span class="token builtin class-name">command</span> or process:
    <span class="token function">lsof</span> <span class="token parameter variable">-c</span> process_or_command_name

  - List files opened by a specific process, given its PID:
    <span class="token function">lsof</span> <span class="token parameter variable">-p</span> PID

  - List <span class="token function">open</span> files <span class="token keyword">in</span> a directory:
    <span class="token function">lsof</span> +D path/to/directory

  - Find the process that is listening on a <span class="token builtin class-name">local</span> TCP port:
    <span class="token function">lsof</span> <span class="token parameter variable">-iTCP:port</span> <span class="token parameter variable">-sTCP:LISTEN</span></code></pre>
<p>QED. Therefore better replace <code>man</code> with <code>tldr</code>:</p>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">man</span><span class="token operator">=</span><span class="token string">'tldr'</span></code></pre>
<h2>Tools provided by homebrew</h2>
<p>Let us continue with the tools installed with <code>brew install &lt;name&gt;</code>.</p>
<h3><a href="https://github.com/wting/autojump">autojump</a></h3>
<p>Allows to jump to a directory from anywhere by maintaining a database of the most used directories.</p>
<ul>
<li>Jump to a directory that contains <code>&lt;term&gt;</code>:</li>
</ul>
<pre class="language-shell"><code class="language-shell">j <span class="token operator">&lt;</span>term<span class="token operator">></span></code></pre>
<ul>
<li>Jump to a child directory of current directory that contains <code>&lt;term&gt;</code>:</li>
</ul>
<pre class="language-shell"><code class="language-shell">jc <span class="token operator">&lt;</span>term<span class="token operator">></span></code></pre>
<ul>
<li>Open directory that contains <code>&lt;term&gt;</code> with the file manager:</li>
</ul>
<pre class="language-shell"><code class="language-shell">jo <span class="token operator">&lt;</span>term<span class="token operator">></span></code></pre>
<p>A bit of setup is required though:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /usr/local/etc/profile.d/autojump.sh <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /usr/local/etc/profile.d/autojump.sh</code></pre>
<h3><a href="https://github.com/sharkdp/bat">bat</a></h3>
<p>A very improved version of <code>cat</code> with syntax highlighting and git support.</p>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">cat</span><span class="token operator">=</span><span class="token string">'bat'</span></code></pre>
<p><img src="images/bat.png" alt="bat"></p>
<h3><a href="https://github.com/ogham/exa">exa</a></h3>
<p>Modernized version of <code>ls</code> with git support, colors and much more user friendly.</p>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">ls</span><span class="token operator">=</span><span class="token string">'exa'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">ll</span><span class="token operator">=</span><span class="token string">'exa -l'</span></code></pre>
<p><img src="images/exa.png" alt="exa"></p>
<h3><a href="https://github.com/junegunn/fzf">fzf</a></h3>
<p>A very fast interactive search tool for files, command history, processes, hostnames, bookmarks, git commits and other things with fuzzy logic. We will connect it with <code>bat</code> to enable a preview of the selected file:</p>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">f</span><span class="token operator">=</span><span class="token string">'fzf --preview "bat --color \"always\" {}"'</span></code></pre>
<div class="center">
  <img class="gif" src="images/fzf.gif" />
</div>
<h3><a href="https://github.com/nicolargo/glances">glances</a></h3>
<p>Improved <code>htop</code>.</p>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">top</span><span class="token operator">=</span><span class="token string">'glances'</span></code></pre>
<p><img src="images/glances.png" alt="glances"></p>
<h3><a href="https://httpie.org/">httpie</a></h3>
<p>A command line HTTP client with an intuitive UI, JSON support, syntax highlighting, wget-like downloads and plugins.</p>
<div class="center">
  <img class="gif" src="images/http.gif" />
</div>
<h3><a href="https://github.com/stedolan/jq">jq</a></h3>
<p>A JSON processor for the command line with many possibilities, e.g. extract an attribute of each object in an array:</p>
<pre class="language-shell"><code class="language-shell">http get <span class="token string">'https://api.github.com/users/akullpp/repos'</span> <span class="token operator">|</span> jq <span class="token string">'.[].name'</span>
<span class="token string">"akGulp"</span>
<span class="token string">"akSkeleton"</span>
<span class="token string">"algodat"</span>
<span class="token string">"arabro"</span>
<span class="token string">"awesome-java"</span>
<span class="token string">"awesome-java-lint"</span>
<span class="token punctuation">..</span>.</code></pre>
<h3><a href="https://asdf-vm.com/#/">asdf-vm</a></h3>
<p>Recently, I uninstalled <code>nvm</code> and <code>pyenv</code> and found a general version manager which allows me not only to manage Node.js and Python versions but also Go and Java. It is based on a open-source plugin system and while I found the user experience less than ideal so far, it is a small hinderance compared to the features.</p>
<h3><a href="https://github.com/nvbn/thefuck">thefuck</a></h3>
<p>Ever mistyped a command or forgot sudo? The Fuck is an intelligent tool which can guess what you meant.</p>
<p>Requires to be initialized properly:</p>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span>thefuck <span class="token parameter variable">--alias</span><span class="token variable">)</span></span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">fu</span><span class="token operator">=</span><span class="token string">'fuck'</span></code></pre>
<div class="center">
  <img class="gif" src="images/fu.gif" />
</div>
<h2>ZSH</h2>
<p>Here's the full <code>.zshrc</code> with all aliases, exports and tools configured:</p>
<pre class="language-shell"><code class="language-shell">
<span class="token comment">##########</span>
<span class="token comment"># prezto #</span>
<span class="token comment">##########</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">${ZDOTDIR<span class="token operator">:-</span>$HOME}</span>/.zprezto/init.zsh"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token builtin class-name">source</span> <span class="token string">"<span class="token variable">${ZDOTDIR<span class="token operator">:-</span>$HOME}</span>/.zprezto/init.zsh"</span>
<span class="token keyword">fi</span>

<span class="token comment">########</span>
<span class="token comment"># asdf #</span>
<span class="token comment">########</span>

<span class="token builtin class-name">.</span> /usr/local/opt/asdf/asdf.sh
<span class="token builtin class-name">.</span> /usr/local/opt/asdf/etc/bash_completion.d/asdf.bash

<span class="token comment">############</span>
<span class="token comment"># autojump #</span>
<span class="token comment">############</span>

<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /usr/local/etc/profile.d/autojump.sh <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /usr/local/etc/profile.d/autojump.sh

<span class="token comment">###########</span>
<span class="token comment"># thefuck #</span>
<span class="token comment">###########</span>

<span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span>thefuck <span class="token parameter variable">--alias</span><span class="token variable">)</span></span>

<span class="token comment">###########</span>
<span class="token comment"># Aliases #</span>
<span class="token comment">###########</span>

<span class="token builtin class-name">alias</span> <span class="token assign-left variable">fu</span><span class="token operator">=</span><span class="token string">'fuck'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">ls</span><span class="token operator">=</span><span class="token string">'exa'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">ll</span><span class="token operator">=</span><span class="token string">'exa -l'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">cat</span><span class="token operator">=</span><span class="token string">'bat'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">f</span><span class="token operator">=</span><span class="token string">'fzf --preview "bat --color \"always\" {}"'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">man</span><span class="token operator">=</span><span class="token string">'tldr'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">top</span><span class="token operator">=</span><span class="token string">'glances'</span>

<span class="token comment">###############</span>
<span class="token comment"># Environment #</span>
<span class="token comment">###############</span>

<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=~</span>/go-workspace/bin:~/go/bin:<span class="token environment constant">$PATH</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=~</span>/go-workspace
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FZF_DEFAULT_OPTS</span><span class="token operator">=</span><span class="token string">"--bind='ctrl-o:execute(code {})+abort'"</span>

<span class="token comment">#######</span>
<span class="token comment"># Run #</span>
<span class="token comment">#######</span>

ll</code></pre>


    <footer class="navigation">
      <ul>
        <li>
          <a href="/privacy">Privacy</a>
        </li>

        <li>
          <a href="/legal">Legal</a>
        </li>
      </ul>
    </footer>
  </body>
</html>

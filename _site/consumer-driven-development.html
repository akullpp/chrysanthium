<!doctype html>
<html lang="en">
  <head>
    <title>Consumer-driven Development || Chrysanthium</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="akullpp" />
    <meta name="description" content="About software engineering" />
    <meta name="email" content="akullpp@gmail.com" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:creator" content="" />
    <meta name="twitter:title" content="Consumer-driven Development" />
    <meta name="twitter:image" content="https://chrysanthium.com/logo.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/post.css">
    <link rel="stylesheet" href="/css/tomorrow.css">
  </head>

  <body>
    <header class="navigation">
      <ul>
        <li>
          <a href="/">Blog</a>
        </li>

        <li>
          <a href="/about">About</a>
        </li>
      </ul>
    </header>

    <h1>Consumer-driven Development</h1>
    
      <h6>2019/05</h6>
    

    <p><strong>Consumer-driven</strong> in this case means from the viewpoint of the client consuming a REST API by a remote service, indeed it could be any kind of API, even a method, theoretically. We want to assert that the provider returns the expected contract which we defined during the refinement phase.</p>
<blockquote>
<p>Consumer-driven development enables engagement in technical requirements analysis process early on</p>
</blockquote>
<p>Let us construct an example by saying that a frontend developer talked to a backend guy and told him the call he wants the following structure to create a new contact:</p>
<pre class="language-json"><code class="language-json">POST /contact <span class="token punctuation">{</span>
  <span class="token property">"firstname"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token property">"lastname"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token property">"address"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"street"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">"city"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">"country"</span><span class="token operator">:</span> string

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"contact"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"phone"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">"email"</span><span class="token operator">:</span> string
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The direction of communication here is important, the consumer tells what he wants and the producer creates the required interface. This is how you ensure that you do not fall in the <a href="https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it">YAGNI</a> trap and think about the requirements early in the process which enables you to minimize integration costs once the interface is ready to go live.</p>
<blockquote>
<p>Consumer-driven development will improve communication on critical intersections of responsibilities</p>
</blockquote>
<p>The consumer also defines what he expects to be returned in success and error cases, e.g.:</p>
<pre class="language-json"><code class="language-json"><span class="token number">200</span> <span class="token punctuation">{</span>
  <span class="token property">"firstname"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token property">"lastname"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token property">"address"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"street"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">"city"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">"country"</span><span class="token operator">:</span> string

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"contact"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"phone"</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">"email"</span><span class="token operator">:</span> string
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token number">400</span> <span class="token punctuation">{</span>
  <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"VALIDATION"</span><span class="token punctuation">,</span>
  <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    string<span class="token punctuation">,</span>
    ...
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token number">409</span> <span class="token punctuation">{</span>
  <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"DUPLICATION"</span>
<span class="token punctuation">}</span></code></pre>
<p>Best practice is to keep this information in specific, version-controlled, files. This way you can review changes separately from logic, have a history and even can maintain branches.</p>
<blockquote>
<p>Consumer-driven development provides the evolution of an interface</p>
</blockquote>
<p>Indeed you could use <a href="https://docs.pact.io/">Pact</a> or even derive APIs from the contracts but additional tools require an additional learning curve are often too much because project situation does not justify the additional complexity.</p>
<p>The next step and the first of the every implementation is to write tests against the defined contracts. This is done on provider- as well as on consumer-side. I like to do this in a separate repository with the stack of <a href="https://github.com/avajs/ava">ava</a> as test runner, <a href="https://github.com/axios/axios">axios</a> for a better request API, <a href="https://github.com/marak/Faker.js">faker</a> to generate random data and <a href="https://github.com/hapijs/joi">joi</a> to validate the response according to a scheme. You can see this in action with the <a href="https://github.com/akullpp/consumer-driven-contracts">example repository on GitHub</a>.</p>
<blockquote>
<p>Consumer-driven development helps to write tests early on</p>
</blockquote>
<p>Disregard your stack, the provider should provide a simple mock which generates random data, this is done in about an hour or so at most. Only in situations where direct communication is impossible, you should set up your own mock. Nevertheless, if everything works out fine, there will be no recognizable downtime if the provider takes the real thing online and your integration certainly should not break, otherwise the process was done wrong.</p>
<blockquote>
<p>Consumer-driven development nullifies the cost of integration</p>
</blockquote>
<p>Whenever the provider changes the interface in the future, or more precisely, whenever the tests are executed - which should be fairly often - <strong>broken tests will indicate a breaking change or infrastructural issue</strong>.</p>


    <footer class="navigation">
      <ul>
        <li>
          <a href="/privacy">Privacy</a>
        </li>

        <li>
          <a href="/legal">Legal</a>
        </li>
      </ul>
    </footer>
  </body>
</html>
